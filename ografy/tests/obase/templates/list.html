{% load backend_utils %}
<!doctype html>
<html>
<head>
	<title>Ografy oBase Input Test Forms</title>
<body>
<h1>Ografy oBase Input Test Forms</h1>

<h4>Event</h4>

<form action="#" method="post">{% csrf_token %}
	<div>
		<label>Signal ID:</label>
		<select id="event-signal-id" name="event-signal-id" type="text" value="1">
		</select>
	</div>
	<div>
		<label>Signal ID:</label>
		<select id="event-signal-id" name="event-signal-id" type="text" value="1">
		</select>
	</div>
	<div>
		<label>Signal ID:</label>
		<select id="event-signal-id" name="event-signal-id" type="text" value="1">
		</select>
	</div>
	<div>
		<label>Signal ID:</label>
		<select id="event-signal-id" name="event-signal-id" type="text" value="1">
		</select>
	</div>
	<div>
		<label>Signal ID:</label>
		<select id="event-signal-id" name="event-signal-id" type="text" value="1">
		</select>
	</div>
</form>

<button type="button" d="event-submit" name="event-submit" >Addd Event</button>

<p><strong>Add Event Result Data:</strong><span id="event-result"></span></p>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script type="text/javascript">










	var modalDialog = function(modalId, modalLinkName, submitHandler, openHandler) {
		var $modal;

		$modal = $(modalId).modal({show: false});

		$modal.on('click', '.btn-primary', submitHandler || function(event) {
			event.preventDefault();
			$modal.find('form').submit();
		});

		if (modalLinkName) {
			$('a[name="' + modalLinkName + '"]').on('click', function(event) {
				event.preventDefault();
				$modal.modal('toggle');

				if (openHandler) {
					openHandler($modal);
				}
			});
		}

		return $modal;
	};

	$(function() {

		modalDialog('#livejournal-modal', 'livejournal');
		modalDialog('#openid-modal', 'openid');
		modalDialog('#email-modal', 'email');
		modalDialog('#username-modal', 'username');
		$validationModal = modalDialog('#validation-sent-modal');
		$emailRequired = modalDialog('#email-required-modal');

		modalDialog('#ajax-call-modal', 'ajax-call', function(event) {
					var $backend, $result, $form;
					event.preventDefault();
					$modaldialog = $(this).closest('.modal');
					$form = $modaldialog.find('form');
					$backend = $modaldialog.find('[name="logged-in-backend"]');
					$call_url = $modaldialog.find('[name="api_call_url"]');
					$result = $modaldialog.find('.login-result');

					$.get('/auth/call/' + $backend.text().trim() + '/', {
						backend_id: $backend.val(),
						api_call_url: $call_url.val()
					}).done(function(data, xhr, response) {
						$result.find('.user-id').html(data.user_id);
						$result.find('.user-username').html(data.username);
						$result.find('.ajax-API-result-data').html(data);
						$form.hide();
						$result.show();
						setTimeout(function() {
							window.location = '/';
						}, 10000);
					});
				},
				function($modal) {
					$.get('/auth/signals/', {}).done(
							function(data, xhr, response) {
								$logged_in_backend = $modal.find('[name="logged-in-backend"]');
								$.each(data, function(index, item) {
									$logged_in_backend.append(
											$('<option></option>').val(item.id).html(item.provider)
									);
								});
							});
				}
		);
	};
</script>
</body>
</html>
