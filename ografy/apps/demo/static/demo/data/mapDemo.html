<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js"></script>
		<link rel="stylesheet" type="text/css" href="https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css" />

		<style type="text/css">
			body {
				margin: 0;
				padding: 0;
			}

			#map {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}

			#map-ui {
				position: absolute;
				top: 0px;
				right: 0px;
				z-index: 100;
				padding: 10px;
				background: rgba(255, 255, 255, 0.75);
				border: 1px solid #fff;
				border-radius: 3px;
			}

			#map-ui ul {
				list-style: none;
				margin: 0;
				padding: 0;
			}

			#info {
				background: rgba(255, 255, 255, 0.75);
				border: 1px solid #fff;
				position: absolute;
				width: 260px;
				top: 0px;
				left: 0px;
				z-index: 100;
				padding: 10px;
				border-radius: 3px;
			}

			#info > h2, h3, p {
				padding: 0px;
				margin: 0px auto;
			}

			#info > img {
				display: block;
				padding: 0px;
				max-width: 240px;
				margin: 10px auto;
			}

			input[type=checkbox].css-checkbox {
				display: none;
			}

			input[type=checkbox].css-checkbox + label.css-label {
				vertical-align: middle;
				cursor: pointer;
				display: inline-block;
				-webkit-appearance: none;
				-moz-appearance: none;
				appearance: none;
				cursor: pointer;
				width: 100%;
				box-sizing: border-box;
				vertical-align: middle;
				outline: none;
				border: none;
				margin: 0.25em 0;
				padding: 0.4em 1em;
				line-height: 1;
				font-weight: 700;
				font-style: normal;
				text-align: center;
				text-decoration: none;
				text-transform: uppercase;
				color: #808080;
				background-color: #FAFAFA;
				background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0)), to(rgba(0, 0, 0, 0.05)));
				background-image: -webkit-linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.05));
				background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.05));
				border-radius: 0.25em;
				-webkit-box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.08) inset;
				box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.08) inset;
				-moz-user-select: none;
				-ms-user-select: none;
				-webkit-user-select: none;
				user-select: none;
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
				-webkit-transition: opacity 0.25s ease, background-color 0.25s ease, color 0.25s ease, background 0.25s ease, -webkit-box-shadow 0.25s ease;
				transition: opacity 0.25s ease, background-color 0.25s ease, color 0.25s ease, background 0.25s ease, box-shadow 0.25s ease;
			}

			input[type=checkbox].css-checkbox:checked + label.css-label {
				background-position: 0 -24px;
				background-image: -moz-linear-gradient(top, #ebebeb, #fefefe);
				background-image: -webkit-linear-gradient(top, #ebebeb, #fefefe);
				background: #5BBD72;
				box-shadow: 0 1px 2px rgba(0, 0, 0, .2) inset;
				color: #fff;
				text-shadow: 0 0 2px #fff;
			}

			label.css-label {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
		</style>

		<script type="text/javascript">
			var jsonMarkers = {
			  "features": [
				{
				  "geometry": {
					"coordinates": [
					  [-73.9928662776947, 40.767590423915316],
					  [-73.99043083190918, 40.76655033385171],
					  [-73.98857474327087, 40.769101775774935],
					  [-73.98287773132324, 40.76672910048988],
					  [-73.98275971412659, 40.76689974092317],
					  [-73.98264169692992, 40.76707038091832]
					],
					"type": "LineString"
				  },
				  "properties": {
					"description": "from Home to Columbus Coffee",
					"id": "marker-htbzz7b90",
					"stroke": "#a3e46b",
					"stroke-opacity": 1,
					"stroke-width": 13,
					"title": "Walking Trip",
					"data-type": "Movement",
					"data-time": "5:28 - 5:42 pm Duration 14 minutes"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.99025917053223, 40.766826609362575],
					"type": "Point"
				  },
				  "properties": {
					"description": "Lisa is at W56TH ST and 8Th AVE",
					"id": "marker-htbzzpcz1",
					"marker-color": "#1087bf",
					"marker-size": "large",
					"marker-symbol": "telephone",
					"title": "Call from Lisa",
					"data-type": "Call",
					"data-time": "5:31 pm",
					"data-image-uri": "/static/demo/portraits/lisa-portrait.jpg"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.99286091327667, 40.767592455325314],
					"type": "Point"
				  },
				  "properties": {
					"description": "1104 W53RD ST - Leaving 5:28 pm for Columbus Coffee",
					"id": "marker-htc035r12",
					"marker-color": "#c5e96f",
					"marker-size": "large",
					"marker-symbol": "",
					"title": "Home",
					"data-type": "Movement",
					"data-time": "Now"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.98935794830322, 40.76811046284268],
					"type": "Point"
				  },
				  "properties": {
					"description": "Duration 3 minutes - Lisa is at W57TH ST and 8Th AVE",
					"id": "marker-htc09zbv3",
					"marker-color": "#1087bf",
					"marker-size": "large",
					"marker-symbol": "emergency-telephone",
					"title": "Call from Lisa Ended",
					"data-type": "Call",
					"data-time": "5:36 pm",
					"data-image-uri": "/static/demo/portraits/lisa-portrait.jpg"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.98594617843627, 40.76802920702854],
					"type": "Point"
				  },
				  "properties": {
					"description": "Subject: Happy Birthday",
					"id": "marker-htc0b3074",
					"marker-color": "#f5c272",
					"marker-size": "large",
					"marker-symbol": "post",
					"title": "Email to James",
					"data-type": "Message",
					"data-time": "5:44 pm",
					"data-image-uri": "/static/demo/portraits/james-portrait.jpg"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.98264169692992, 40.767074443770014],
					"type": "Point"
				  },
				  "properties": {
					"description": "Trip ended at Columbus Coffee",
					"id": "marker-htc0dzeu5",
					"marker-color": "#f86767",
					"marker-size": "large",
					"marker-symbol": "",
					"title": "Trip Ended",
					"data-type": "Movement",
					"data-time": "5:42 pm"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.99122476577759, 40.76893926647161],
					"type": "Point"
				  },
				  "properties": {
					"description": "Steve shared a Photo with you on Facebook - Description: We nailed it! - Steve is at W56TH ST and 11Th AVE",
					"id": "marker-htc0glld6",
					"marker-color": "#9c89cc",
					"marker-size": "large",
					"marker-symbol": "camera",
					"title": "Photo Shared",
					"data-type": "Message",
					"data-time": "4:40 pm",
					"data-image-uri": "/static/demo/portraits/we-did-it.jpg"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.9830869436264, 40.76725320899833],
					"type": "Point"
				  },
				  "properties": {
					"description": "You checked in to Columbus Coffee on Foursquare",
					"id": "marker-htc0j31h7",
					"marker-color": "#f1f075",
					"marker-size": "large",
					"marker-symbol": "polling-place",
					"title": "Check-In",
					"data-type": "Event",
					"data-time": "5:54 pm"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.98195505142212, 40.76819171855746],
					"type": "Point"
				  },
				  "properties": {
					"description": "Lisa Doe - 0.2 miles away",
					"id": "marker-htc1h2ha0",
					"marker-color": "#d27591",
					"marker-size": "large",
					"marker-symbol": "l",
					"title": "Lisa",
					"data-type": "Person",
					"data-time": "Now",
					"data-image-uri": "/static/demo/portraits/lisa-portrait.jpg"
				  },
				  "type": "Feature"
				},
				{
				  "geometry": {
					"coordinates": [-73.99073123931885, 40.76844361064188],
					"type": "Point"
				  },
				  "properties": {
					"description": "Steve Wood - 0.65 miles away",
					"id": "marker-htc1t4i60",
					"marker-color": "#677da7",
					"marker-size": "large",
					"marker-symbol": "s",
					"title": "Steve",
					"data-type": "Person",
					"data-time": "Now",
					"data-image-uri": "/static/demo/portraits/steve-portrait.jpg"
				  },
				  "type": "Feature"
				}
			  ],
			  "id": "liambroza.hl46f2ok",
			  "type": "FeatureCollection"
			};
		</script>

		<script type="text/javascript">
			function onload() {
				var map = L.mapbox.map('map', 'liambroza.hl4bi8d0', {
					zoomControl: false
				}).setView([40.768, -73.988], 16);
				map.featureLayer = L.mapbox.featureLayer(jsonMarkers).addTo(map);

				// find and store a variable reference to the list of filters
				var filters = document.getElementById('filters');

				map.featureLayer.on('ready', function () {
					var typesObj = {}, types = [];
					var features = map.featureLayer.getGeoJSON().features;
					for (var i = 0; i < features.length; i++) {
						typesObj[features[i].properties['data-type']] = true;
					}

					// disable drag and zoom handlers
					map.dragging.disable();
					map.touchZoom.disable();
					map.doubleClickZoom.disable();
					map.scrollWheelZoom.disable();
					// disable tap handler, if present.
					if (map.tap) map.tap.disable();

					// Listen for individual marker clicks
					map.featureLayer.on('mouseover', function (e) {
						// Force the popup closed.
						e.layer.closePopup();

						var feature = e.layer.feature;
						var info = '<h2>' + feature.properties.title + '</h2>' +
								'<h3>' + feature.properties['data-time'] + '</h3>' +
								'<p>' + feature.properties.description + '</p>';

						if (feature.properties['data-image-uri'] !== undefined) {
							info += '<img src=' + feature.properties['data-image-uri'] + ' />';
						}
						document.getElementById('info').innerHTML = info;
					});

					for (var k in typesObj) types.push(k);

					var checkboxes = [];
					// create a filter interface
					for (var i = 0; i < types.length; i++) {
						// create an <li> list element for each type, and add an input checkbox
						// and label inside
						var li = filters.appendChild(document.createElement('li'));
						var checkbox = li.appendChild(document.createElement('input'));
						var label = li.appendChild(document.createElement('label'));
						checkbox.type = 'checkbox';
						checkbox.id = types[i];
						checkbox.checked = false;
						checkbox.classList.add("css-checkbox")
						// create a label to the right of the checkbox with explanatory text
						label.innerHTML = types[i];
						label.classList.add("css-label")
						label.setAttribute('for', types[i]);
						// whenever a person clicks on this checkbox, call the update() function
						// below
						checkbox.addEventListener('change', update);
						checkboxes.push(checkbox);
					}

					// this function is called whenever someone clicks on a checkbox and changes
					// the selection of markers to be displayed
					function update() {
						var enabled = {};
						// run through each checkbox and record whether it is checked. If it is,
						// add it to the object of types to display, otherwise do not.
						for (var i = 0; i < checkboxes.length; i++) {
							if (checkboxes[i].checked) enabled[checkboxes[i].id] = true;
						}
						map.featureLayer.setFilter(function (feature) {
							// if this symbol is in the list, return true. if not, return false.
							// the 'in' operator in javascript does exactly that: given a string
							// or number, it says if that is in a object
							// 2 in { 2: true } // true
							// 2 in { } // false
							return (feature.properties['data-type'] in enabled);
						});
					}

					var i = 0;//  set your counter to 1
					function cycleCheckboxes (interval) {  //  create a loop function
					   setTimeout(function () { //  call a 3s setTimeout when the loop is called
						   if (0 == i % checkboxes.length && i > 0){
								for (var j = 1; j < checkboxes.length; j++) {
									checkboxes[j].checked = false;
								}
								update()
							}else{
								checkboxes[i % checkboxes.length].checked = true;
								update()
							}
						  i++; //  increment the counter
						  if (i < 25) {  //  if the counter < 10, call the loop function
							 cycleCheckboxes(interval);  //  ..  again which will trigger another
						  } //  ..  setTimeout()
					   }, interval)
					}
					update();
					cycleCheckboxes(2500);
				});
			}
		</script>
	</head>
	<body onload="onload();">
		<div id="map-ui">
			<ul id="filters"></ul>
		</div>
		<div id="map"></div>
		<div id="info">
			<h2>Take a Trip</h2>
			<h3>Select a Marker</h3>
		</div>
	</body>
</html>
