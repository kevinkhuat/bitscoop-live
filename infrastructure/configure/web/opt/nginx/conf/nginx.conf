worker_processes  1;
pid /var/run/nginx.pid;

events {
    worker_connections              1024;
}

http {
    passenger_root                  /opt/passenger;
    passenger_ruby                  /usr/bin/ruby;
    passenger_python                /usr/local/bin/python3.4;

    include                         mime.types;
    default_type                    application/octet-stream;

    access_log                      /dev/null;
    error_log                       /dev/null;

    sendfile                        on;
    keepalive_timeout               65;


    # Rewrite http requests to https.
    server {
        listen                      80;
        server_name                 ografy.io;
        return                      301 https://$server_name$request_uri;
    }

    server {
        listen                      443 ssl;
        server_name                 ografy.io;

        access_log                  /var/log/nginx/ografy.io/www/access.log;
        error_log                   /var/log/nginx/ografy.io/www/error.log;

        ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
        ssl_certificate             /etc/ssl/certs/www.ografy.io.crt;
        ssl_certificate_key         /etc/ssl/certs/www.ografy.io.key;

        add_header                  Cache-Control "no-cache, private";

        passenger_enabled           on;
        root                        /home/ografy/sites/ografy.io/www/public;
    }


    # WWW SUB-DOMAIN
    server {
        listen                      80;
        listen                      443;

        server_name                 www.ografy.io;
        return                      301 https://ografy.io$request_uri;
    }


    # STATIC SUB-DOMAIN
    server {
        listen                      80;
        server_name                 static.ografy.io;
        return                      301 https://$server_name$request_uri;
    }

    server {
        listen                      443 ssl;
        server_name                 static.ografy.io;

        access_log                  /var/log/nginx/ografy.io/static/access.log;
        error_log                   /var/log/nginx/ografy.io/static/error.log;

        ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
        ssl_certificate             /etc/ssl/certs/static.ografy.io.crt;
        ssl_certificate_key         /etc/ssl/certs/static.ografy.io.key;

        root                        /home/ografy/sites/ografy.io/static/public;

        location ~* \.(ttf|otf|eot|woff|tsv)$ {
            add_header Access-Control-Allow-Origin "$http_origin";
        }

        location ~* \.(ttf|otf|eot|woff|svg|ico|jpg|jpeg|png|gif|js|css)$ {
            expires                 1y;
            log_not_found           off;
        }
    }
}
